<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üéÆ Flappy Charlie - Hire Him Already!</title>
    <link rel="stylesheet" href="elements.css">
    <style>
        body {
            overflow: hidden;
            touch-action: none;
        }

        #game-container {
            position: relative;
            margin: 20px auto;
            max-width: 400px;
        }

        #game-canvas {
            border: 5px ridge #00ff00;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 30px rgba(0, 255, 0, 0.6);
            background: linear-gradient(to bottom, #87CEEB, #E0F6FF);
            cursor: pointer;
            touch-action: none;
            width: 100%;
            max-width: 400px;
            height: 600px;
        }

        .game-info {
            text-align: center;
            margin: 20px 0;
        }

        .score-display {
            font-size: 48px;
            color: #ffff00;
            font-weight: bold;
            text-shadow: 3px 3px #ff00ff;
            margin: 10px 0;
        }

        .high-score {
            font-size: 20px;
            color: #00ffff;
        }

        .start-screen, .game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .start-screen h1 {
            font-size: 48px;
            color: #ffff00;
            text-shadow: 3px 3px #ff00ff;
            margin-bottom: 20px;
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        .instructions {
            background: rgba(0, 255, 255, 0.2);
            border: 3px dashed #00ffff;
            padding: 20px;
            margin: 20px;
            border-radius: 10px;
            max-width: 300px;
        }

        .instructions p {
            color: #00ffff;
            font-size: 18px;
            margin: 10px 0;
        }

        .username-form {
            background: rgba(51, 0, 102, 0.9);
            border: 5px ridge #00ffff;
            padding: 25px;
            border-radius: 15px;
            margin: 20px;
        }

        .username-form input {
            width: 250px;
            padding: 12px;
            font-size: 18px;
            background: #000;
            border: 3px inset #00ffff;
            color: #00ff00;
            font-family: "Comic Sans MS", Arial;
            margin: 10px 0;
        }

        .festival-options {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 15px 0;
        }

        .festival-btn {
            padding: 8px 15px;
            background: rgba(0, 255, 255, 0.2);
            border: 2px solid #00ffff;
            color: #00ffff;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-family: "Comic Sans MS", Arial;
        }

        .festival-btn.selected {
            background: rgba(255, 255, 0, 0.4);
            border-color: #ffff00;
            color: #ffff00;
        }

        .leaderboard {
            background: rgba(0, 0, 0, 0.8);
            border: 3px ridge #ffd700;
            padding: 20px;
            margin: 20px auto;
            max-width: 500px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard h3 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 15px;
        }

        .leaderboard-entry {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid #00ffff;
            border-radius: 5px;
        }

        .leaderboard-entry.top-1 {
            background: rgba(255, 215, 0, 0.2);
            border-left-color: #ffd700;
        }

        .leaderboard-entry.top-2 {
            background: rgba(192, 192, 192, 0.2);
            border-left-color: #c0c0c0;
        }

        .leaderboard-entry.top-3 {
            background: rgba(205, 127, 50, 0.2);
            border-left-color: #cd7f32;
        }

        .badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 10px;
            margin-left: 5px;
        }

        .badge-latitude {
            background: linear-gradient(135deg, #FF6B9D, #C06C84);
            color: white;
        }

        .badge-leeds {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
        }

        .badge-boomtown {
            background: linear-gradient(135deg, #F2994A, #F2C94C);
            color: #000;
        }

        .game-over-message {
            font-size: 56px;
            color: #ff0000;
            font-weight: bold;
            text-shadow: 4px 4px #000;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .final-score-display {
            font-size: 36px;
            color: #ffff00;
            margin: 20px 0;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        @media (max-width: 500px) {
            #game-canvas {
                height: 500px;
            }

            .start-screen h1 {
                font-size: 36px;
            }

            .instructions {
                margin: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

<div class="wrapper">
    <h1>üéÆ FLAPPY CHARLIE</h1>
    <marquee behavior="alternate" scrollamount="5">
        ‚ö° TAP TO FLAP ‚ö° DODGE OBSTACLES ‚ö° GET HIGH SCORE ‚ö°
    </marquee>

    <p class="blink">The most hireable flappy game ever made!</p>

    <div class="game-info">
        <div class="score-display" id="score-display">0</div>
        <div class="high-score" id="high-score">High Score: 0</div>
    </div>

    <div id="game-container">
        <canvas id="game-canvas" width="400" height="600"></canvas>

        <!-- START SCREEN -->
        <div class="start-screen" id="start-screen">
            <h1>üéÆ FLAPPY CHARLIE üéÆ</h1>
            
            <div class="instructions">
                <p><strong>üì± HOW TO PLAY:</strong></p>
                <p>üëÜ TAP or CLICK to flap</p>
                <p>üö´ Avoid the pipes</p>
                <p>üèÜ Get the highest score!</p>
            </div>

            <div class="username-form">
                <h3 style="color: #ffff00; margin-bottom: 10px;">Enter Your Name:</h3>
                <input type="text" id="player-name" placeholder="Your name..." maxlength="20">
                
                <div class="festival-options">
                    <button class="festival-btn" onclick="selectFestival('latitude', this)">
                        üé™ Latitude
                    </button>
                    <button class="festival-btn" onclick="selectFestival('leeds', this)">
                        üéµ Leeds
                    </button>
                    <button class="festival-btn" onclick="selectFestival('boomtown', this)">
                        üí• Boomtown
                    </button>
                    <button class="festival-btn selected" onclick="selectFestival('none', this)">
                        üåê None
                    </button>
                </div>
                
                <button class="button" onclick="startGame()" style="margin-top: 15px; font-size: 20px;">
                    üöÄ START GAME
                </button>
            </div>

            <p style="color: #888; font-size: 12px; margin-top: 20px;">
                üí° Tip: Play this at festivals to boost Charlie's hiring chances!
            </p>
        </div>

        <!-- GAME OVER SCREEN -->
        <div class="game-over-screen" id="game-over-screen" style="display: none;">
            <div class="game-over-message">GAME OVER!</div>
            
            <div class="final-score-display">
                Final Score: <span id="final-score">0</span>
            </div>

            <div style="background: rgba(255, 0, 0, 0.2); border: 3px solid #ff0000; padding: 20px; border-radius: 10px; margin: 20px; max-width: 300px;">
                <h3 style="color: #ffff00; margin-bottom: 10px;">üö® IMPORTANT MESSAGE üö®</h3>
                <p style="color: #00ffff; font-size: 16px;">
                    You just played a game built by Charlie.<br>
                    Clearly he has skills.<br>
                    <strong style="color: #ffff00;">Maybe you should hire him? ü§î</strong>
                </p>
            </div>

            <div class="share-buttons">
                <button class="button" onclick="playAgain()">üîÑ Play Again</button>
                <a href="contact.html" class="button" style="background: linear-gradient(to bottom, #ff0000, #cc0000);">
                    üö® HIRE CHARLIE
                </a>
            </div>

            <button class="button" onclick="shareScore()" style="background: linear-gradient(to bottom, #800080, #4b0082);">
                üì§ Share Score
            </button>
        </div>
    </div>

    <!-- LEADERBOARD -->
    <div class="leaderboard">
        <h3>üèÜ TOP 10 HIGH SCORES üèÜ</h3>
        <div id="leaderboard-list">
            <p style="text-align: center; color: #888;">Loading scores...</p>
        </div>
    </div>

    <div class="box" style="margin: 20px auto; max-width: 600px;">
        <h3>üí° Pro Tips:</h3>
        <ul style="list-style: none; padding: 0;">
            <li style="border: none;">üéØ Timing is everything - tap at the right moment</li>
            <li style="border: none;">üìè Stay in the middle when possible</li>
            <li style="border: none;">‚ö° Quick taps = better control</li>
            <li style="border: none;">üèÜ Beat the festival high scores!</li>
        </ul>
    </div>

    <div style="text-align: center; margin: 30px 0;">
        <a class="button" href="index.html">üè† Back to Homepage</a>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
   apiKey: "AIzaSyAVLUuQhdJ8Co80X4k8YylvrzRAM1bPTXs",
  authDomain: "charlie-guestbook.firebaseapp.com",
  databaseURL: "https://charlie-guestbook-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "charlie-guestbook",
  storageBucket: "charlie-guestbook.firebasestorage.app",
  messagingSenderId: "40421298596",
  appId: "1:40421298596:web:0426fdef8f4f3b1c1b3131"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const scoresRef = database.ref('flappyCharlieScores');

// Game Variables
const canvas = document.getElementById('game-canvas');
const ctx = canvas.getContext('2d');

let playerName = '';
let playerFestival = 'none';
let gameRunning = false;
let score = 0;
let highScore = parseInt(localStorage.getItem('flappyCharlieHighScore') || '0');
let frames = 0;

// Bird
let bird = {
    x: 80,
    y: 250,
    width: 50,
    height: 50,
    velocity: 0,
    gravity: 0.5,
    jumpStrength: -8,
    image: new Image()
};
bird.image.src = 'charlie.png';

// Pipes
let pipes = [];
const pipeWidth = 60;
const pipeGap = 180;
const pipeSpeed = 3;

// Ground
let groundX = 0;
const groundSpeed = 3;

// Festival Badge Selection
function selectFestival(festival, btn) {
    playerFestival = festival;
    document.querySelectorAll('.festival-btn').forEach(b => {
        b.classList.remove('selected');
    });
    btn.classList.add('selected');
}

// Start Game
function startGame() {
    const nameInput = document.getElementById('player-name');
    playerName = nameInput.value.trim();
    
    if (playerName.length < 2) {
        alert('‚ö†Ô∏è Name must be at least 2 characters!');
        return;
    }
    
    document.getElementById('start-screen').style.display = 'none';
    
    // Reset game
    bird.y = 250;
    bird.velocity = 0;
    pipes = [];
    score = 0;
    frames = 0;
    gameRunning = true;
    
    document.getElementById('score-display').textContent = '0';
    
    gameLoop();
}

// Jump
function jump() {
    if (!gameRunning) return;
    bird.velocity = bird.jumpStrength;
}

// Event Listeners
canvas.addEventListener('click', jump);
canvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    jump();
});

document.addEventListener('keydown', (e) => {
    if (e.code === 'Space' && gameRunning) {
        e.preventDefault();
        jump();
    }
});

// Create Pipe
function createPipe() {
    const minHeight = 50;
    const maxHeight = canvas.height - pipeGap - minHeight - 100;
    const height = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
    
    pipes.push({
        x: canvas.width,
        top: height,
        bottom: height + pipeGap,
        scored: false
    });
}

// Update Game
function update() {
    if (!gameRunning) return;
    
    frames++;
    
    // Bird physics
    bird.velocity += bird.gravity;
    bird.y += bird.velocity;
    
    // Create pipes
    if (frames % 90 === 0) {
        createPipe();
    }
    
    // Update pipes
    pipes.forEach((pipe, index) => {
        pipe.x -= pipeSpeed;
        
        // Score
        if (!pipe.scored && pipe.x + pipeWidth < bird.x) {
            score++;
            pipe.scored = true;
            document.getElementById('score-display').textContent = score;
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('flappyCharlieHighScore', highScore.toString());
                document.getElementById('high-score').textContent = 'High Score: ' + highScore;
            }
        }
        
        // Remove off-screen pipes
        if (pipe.x + pipeWidth < 0) {
            pipes.splice(index, 1);
        }
    });
    
    // Ground scroll
    groundX -= groundSpeed;
    if (groundX <= -50) groundX = 0;
    
    // Collision detection
    checkCollision();
}

// Draw Game
function draw() {
    // Sky
    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
    gradient.addColorStop(0, '#87CEEB');
    gradient.addColorStop(1, '#E0F6FF');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // Clouds (simple)
    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
    ctx.beginPath();
    ctx.arc(100 + (frames % 400) - 100, 100, 30, 0, Math.PI * 2);
    ctx.arc(300 + (frames % 300) - 100, 150, 40, 0, Math.PI * 2);
    ctx.fill();
    
    // Pipes
    pipes.forEach(pipe => {
        // Top pipe
        ctx.fillStyle = '#00ff00';
        ctx.fillRect(pipe.x, 0, pipeWidth, pipe.top);
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 3;
        ctx.strokeRect(pipe.x, 0, pipeWidth, pipe.top);
        
        // Bottom pipe
        ctx.fillRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom - 100);
        ctx.strokeRect(pipe.x, pipe.bottom, pipeWidth, canvas.height - pipe.bottom - 100);
        
        // Pipe cap
        ctx.fillStyle = '#00cc00';
        ctx.fillRect(pipe.x - 5, pipe.top - 20, pipeWidth + 10, 20);
        ctx.strokeRect(pipe.x - 5, pipe.top - 20, pipeWidth + 10, 20);
        ctx.fillRect(pipe.x - 5, pipe.bottom, pipeWidth + 10, 20);
        ctx.strokeRect(pipe.x - 5, pipe.bottom, pipeWidth + 10, 20);
    });
    
    // Ground
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(0, canvas.height - 100, canvas.width, 100);
    
    // Ground pattern
    ctx.fillStyle = '#654321';
    for (let i = groundX; i < canvas.width; i += 50) {
        ctx.fillRect(i, canvas.height - 100, 25, 10);
    }
    
    // Grass
    ctx.fillStyle = '#00ff00';
    ctx.fillRect(0, canvas.height - 100, canvas.width, 10);
    
    // Bird (Charlie's face!)
    if (bird.image.complete) {
        ctx.save();
        ctx.translate(bird.x + bird.width / 2, bird.y + bird.height / 2);
        const rotation = Math.min(Math.max(bird.velocity * 0.05, -0.5), 0.5);
        ctx.rotate(rotation);
        ctx.drawImage(bird.image, -bird.width / 2, -bird.height / 2, bird.width, bird.height);
        ctx.restore();
    } else {
        // Fallback if image not loaded
        ctx.fillStyle = '#ffff00';
        ctx.fillRect(bird.x, bird.y, bird.width, bird.height);
    }
}

// Check Collision
function checkCollision() {
    // Hit ground
    if (bird.y + bird.height > canvas.height - 100 || bird.y < 0) {
        gameOver();
        return;
    }
    
    // Hit pipes
    pipes.forEach(pipe => {
        if (bird.x + bird.width > pipe.x && bird.x < pipe.x + pipeWidth) {
            if (bird.y < pipe.top || bird.y + bird.height > pipe.bottom) {
                gameOver();
            }
        }
    });
}

// Game Over
function gameOver() {
    gameRunning = false;
    
    document.getElementById('final-score').textContent = score;
    document.getElementById('game-over-screen').style.display = 'flex';
    
    // Submit score
    submitScore(playerName, score, playerFestival);
}

// Play Again
function playAgain() {
    document.getElementById('game-over-screen').style.display = 'none';
    bird.y = 250;
    bird.velocity = 0;
    pipes = [];
    score = 0;
    frames = 0;
    gameRunning = true;
    document.getElementById('score-display').textContent = '0';
}

// Share Score
function shareScore() {
    const text = `üéÆ I scored ${score} points in Flappy Charlie! Can you beat that? Check out hirecharlienow.com`;
    
    if (navigator.share) {
        navigator.share({ title: 'Flappy Charlie', text: text });
    } else {
        navigator.clipboard.writeText(text);
        alert('üìã Score copied to clipboard! Share it with your friends!');
    }
}

// Submit Score to Firebase
function submitScore(name, finalScore, festival) {
    scoresRef.push({
        name: name,
        score: finalScore,
        festival: festival,
        timestamp: Date.now()
    });
    
    loadLeaderboard();
}

// Load Leaderboard
function loadLeaderboard() {
    scoresRef.orderByChild('score').limitToLast(10).once('value', (snapshot) => {
        const scores = [];
        snapshot.forEach(child => {
            scores.push(child.val());
        });
        
        scores.reverse();
        
        const listDiv = document.getElementById('leaderboard-list');
        listDiv.innerHTML = '';
        
        if (scores.length === 0) {
            listDiv.innerHTML = '<p style="text-align: center; color: #888;">No scores yet! Be the first!</p>';
            return;
        }
        
        scores.forEach((score, index) => {
            const entry = document.createElement('div');
            entry.className = 'leaderboard-entry';
            if (index === 0) entry.classList.add('top-1');
            if (index === 1) entry.classList.add('top-2');
            if (index === 2) entry.classList.add('top-3');
            
            const medal = index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : index === 2 ? 'ü•â' : '';
            const badge = getFestivalBadge(score.festival);
            
            entry.innerHTML = `
                <span style="font-weight: bold; color: #ffff00; min-width: 30px;">${medal} #${index + 1}</span>
                <span style="flex: 1; color: #00ffff;">${escapeHtml(score.name)}${badge}</span>
                <span style="color: #00ff00; font-weight: bold;">${score.score}</span>
            `;
            
            listDiv.appendChild(entry);
        });
    });
}

function getFestivalBadge(festival) {
    const badges = {
        'latitude': '<span class="badge badge-latitude">üé™</span>',
        'leeds': '<span class="badge badge-leeds">üéµ</span>',
        'boomtown': '<span class="badge badge-boomtown">üí•</span>',
        'none': ''
    };
    return badges[festival] || '';
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Game Loop
function gameLoop() {
    update();
    draw();
    if (gameRunning) {
        requestAnimationFrame(gameLoop);
    }
}

// Initialize
document.getElementById('high-score').textContent = 'High Score: ' + highScore;
loadLeaderboard();
setInterval(loadLeaderboard, 30000);
</script>

<script src="mouse-trail.js"></script>

</body>
</html>
