<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Pixel Art Canvas - Create Together!</title>
    <link rel="stylesheet" href="elements.css">
    <style>
        .canvas-container {
            text-align: center;
            margin: 20px auto;
        }
        
        #pixel-canvas {
            border: 5px ridge #00ffff;
            cursor: crosshair;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            background: #FFFFFF;
            margin: 20px auto;
            display: block;
            max-width: 100%;
            height: auto;
            width: 100%;
        }
        
        @media (min-width: 900px) {
            #pixel-canvas {
                width: 800px;
                height: 800px;
            }
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, 50px);
            gap: 5px;
            max-width: 600px;
            margin: 20px auto;
            justify-content: center;
        }
        
        .color-btn {
            width: 50px;
            height: 50px;
            border: 3px outset #fff;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .color-btn:hover {
            transform: scale(1.1);
            border: 3px inset #fff;
        }
        
        .color-btn.selected {
            border: 5px solid #ffff00;
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
            transform: scale(1.15);
        }
        
        .stats-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: rgba(0, 0, 0, 0.7);
            border: 3px ridge #00ffff;
            padding: 15px 25px;
            border-radius: 8px;
        }
        
        .stat-number {
            font-size: 32px;
            color: #ffff00;
            font-weight: bold;
            text-shadow: 2px 2px #ff00ff;
        }
        
        .stat-label {
            font-size: 14px;
            color: #00ffff;
            margin-top: 5px;
        }
        
        .cooldown-timer {
            font-size: 18px;
            color: #ff00ff;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .info-box {
            background: rgba(255, 215, 0, 0.1);
            border: 3px dotted #ffd700;
            padding: 15px;
            margin: 20px auto;
            max-width: 600px;
        }
    </style>
</head>
<body>

<div class="wrapper">
    <h1>üé® Collaborative Pixel Art</h1>
    <marquee behavior="alternate" scrollamount="5">
        ‚ú® CREATE TOGETHER ‚ú® ONE PIXEL AT A TIME ‚ú® r/place STYLE ‚ú®
    </marquee>
    
    <p class="blink">Every visitor can place pixels. What will we create together?</p>
    
    <!-- Stats -->
    <div class="stats-container">
        <div class="stat-box">
            <div class="stat-number" id="total-pixels">0</div>
            <div class="stat-label">Total Pixels Placed</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="your-pixels">0</div>
            <div class="stat-label">Your Contribution</div>
        </div>
        <div class="stat-box">
            <div class="stat-number" id="artists-count">0</div>
            <div class="stat-label">Artists</div>
        </div>
    </div>
    
    <!-- Canvas -->
    <div class="canvas-container">
        <canvas id="pixel-canvas" width="800" height="800"></canvas>
    </div>
    
    <!-- Cooldown Timer -->
    <div class="cooldown-timer" id="cooldown-timer" style="text-align: center;">
        Ready to place a pixel! üé®
    </div>
    
    <!-- Color Palette -->
    <div class="box">
        <h3 style="text-align: center;">üé® Choose Your Color:</h3>
        <div class="color-palette" id="color-palette">
            <!-- Colors will be generated here -->
        </div>
    </div>
    
    <div class="info-box">
        <h3 style="text-align: center; color: #ffd700;">üìú How It Works:</h3>
        <ul style="list-style: none; padding: 0;">
            <li style="border: none;">‚ú® Pick a color from the palette below</li>
            <li style="border: none;">üñ±Ô∏è Click any pixel on the canvas to place your color</li>
            <li style="border: none;">‚è∞ Wait 10 seconds before placing another pixel</li>
            <li style="border: none;">üåç Everyone sees updates in real-time!</li>
            <li style="border: none;">üé® Work together to create something amazing!</li>
        </ul>
    </div>
    
    <div class="box" style="background: rgba(0, 255, 255, 0.1);">
        <p style="text-align: center; font-style: italic;">
            üí° This canvas is persistent! Your pixels will stay here forever.<br>
            You're contributing to a collective masterpiece! üé®
        </p>
    </div>
    
    <div style="text-align: center; margin-top: 30px;">
        <a class="button" href="index.html">üè† Back to Homepage</a>
        <button class="button" onclick="downloadCanvas()" style="background: linear-gradient(to bottom, #ff00ff, #cc00cc);">
            üíæ Download Canvas
        </button>
    </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
   apiKey: "AIzaSyAVLUuQhdJ8Co80X4k8YylvrzRAM1bPTXs",
  authDomain: "charlie-guestbook.firebaseapp.com",
  databaseURL: "https://charlie-guestbook-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "charlie-guestbook",
  storageBucket: "charlie-guestbook.firebasestorage.app",
  messagingSenderId: "40421298596",
  appId: "1:40421298596:web:0426fdef8f4f3b1c1b3131"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const canvasRef = database.ref('pixelCanvas');
const statsRef = database.ref('canvasStats');

// Canvas Setup
const canvas = document.getElementById('pixel-canvas');
const ctx = canvas.getContext('2d');
const GRID_SIZE = 80; // 80x80 grid
const PIXEL_SIZE = canvas.width / GRID_SIZE; // 10px per pixel

// Color Palette (16 colors - classic 90s/pixel art palette)
const COLORS = [
    '#000000', // Black
    '#FFFFFF', // White
    '#FF0000', // Red
    '#00FF00', // Green
    '#0000FF', // Blue
    '#FFFF00', // Yellow
    '#FF00FF', // Magenta
    '#00FFFF', // Cyan
    '#FF8800', // Orange
    '#8800FF', // Purple
    '#00FF88', // Mint
    '#FF0088', // Hot Pink
    '#888888', // Gray
    '#FF8888', // Light Red
    '#88FF88', // Light Green
    '#8888FF', // Light Blue
];

let selectedColor = COLORS[0];
let myUserId = localStorage.getItem('pixelArtUserId') || 
    'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
localStorage.setItem('pixelArtUserId', myUserId);

let myPixelCount = parseInt(localStorage.getItem('myPixelCount') || '0');
let canPlacePixel = true;
let cooldownSeconds = 10;

// Initialize Color Palette
function initColorPalette() {
    const palette = document.getElementById('color-palette');
    
    COLORS.forEach((color, index) => {
        const btn = document.createElement('div');
        btn.className = 'color-btn' + (index === 0 ? ' selected' : '');
        btn.style.backgroundColor = color;
        btn.onclick = () => selectColor(color, btn);
        palette.appendChild(btn);
    });
}

// Select Color
function selectColor(color, element) {
    selectedColor = color;
    document.querySelectorAll('.color-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
    element.classList.add('selected');
}

// Draw Grid
function drawGrid() {
    ctx.strokeStyle = '#ddd';
    ctx.lineWidth = 0.5;
    
    for (let x = 0; x <= canvas.width; x += PIXEL_SIZE) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
    }
    
    for (let y = 0; y <= canvas.height; y += PIXEL_SIZE) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
    }
}

// Place Pixel
canvas.addEventListener('click', (e) => {
    if (!canPlacePixel) {
        alert('‚è∞ Please wait for the cooldown timer!');
        return;
    }
    
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / rect.width;
    const scaleY = canvas.height / rect.height;
    
    const canvasX = (e.clientX - rect.left) * scaleX;
    const canvasY = (e.clientY - rect.top) * scaleY;
    
    const x = Math.floor(canvasX / PIXEL_SIZE);
    const y = Math.floor(canvasY / PIXEL_SIZE);
    
    if (x >= 0 && x < GRID_SIZE && y >= 0 && y < GRID_SIZE) {
        placePixel(x, y, selectedColor);
    }
});

// Place Pixel in Firebase
function placePixel(x, y, color) {
    const pixelKey = `${x}_${y}`;
    
    canvasRef.child('pixels').child(pixelKey).set({
        color: color,
        userId: myUserId,
        timestamp: Date.now()
    });
    
    myPixelCount++;
    localStorage.setItem('myPixelCount', myPixelCount.toString());
    document.getElementById('your-pixels').textContent = myPixelCount;
    
    statsRef.child('totalPixels').transaction((current) => {
        return (current || 0) + 1;
    });
    
    statsRef.child('artists').child(myUserId).set(true);
    
    startCooldown();
}

// Draw Pixel on Canvas
function drawPixel(x, y, color) {
    ctx.fillStyle = color;
    ctx.fillRect(x * PIXEL_SIZE, y * PIXEL_SIZE, PIXEL_SIZE, PIXEL_SIZE);
}

// Load Canvas from Firebase
function loadCanvas() {
    canvasRef.child('pixels').on('child_added', (snapshot) => {
        const key = snapshot.key;
        const data = snapshot.val();
        const [x, y] = key.split('_').map(Number);
        
        drawPixel(x, y, data.color);
    });
    
    canvasRef.child('pixels').on('child_changed', (snapshot) => {
        const key = snapshot.key;
        const data = snapshot.val();
        const [x, y] = key.split('_').map(Number);
        
        drawPixel(x, y, data.color);
    });
}

// Load Stats
function loadStats() {
    statsRef.child('totalPixels').on('value', (snapshot) => {
        document.getElementById('total-pixels').textContent = snapshot.val() || 0;
    });
    
    statsRef.child('artists').on('value', (snapshot) => {
        document.getElementById('artists-count').textContent = snapshot.numChildren();
    });
    
    document.getElementById('your-pixels').textContent = myPixelCount;
}

// Cooldown Timer
function startCooldown() {
    canPlacePixel = false;
    let remaining = cooldownSeconds;
    
    const timer = setInterval(() => {
        document.getElementById('cooldown-timer').innerHTML = 
            `‚è∞ Wait <span class="blink">${remaining}s</span> before placing another pixel...`;
        remaining--;
        
        if (remaining < 0) {
            clearInterval(timer);
            canPlacePixel = true;
            document.getElementById('cooldown-timer').innerHTML = 
                'Ready to place a pixel! üé®';
        }
    }, 1000);
}

// Download Canvas
function downloadCanvas() {
    const link = document.createElement('a');
    link.download = 'charlie-pixel-art.png';
    link.href = canvas.toDataURL();
    link.click();
    
    alert('üé® Canvas downloaded! Share it with the world!');
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    ctx.fillStyle = '#FFFFFF';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    drawGrid();
    initColorPalette();
    loadCanvas();
    loadStats();
});
</script>

<script src="mouse-trail.js"></script>

</body>
</html>
